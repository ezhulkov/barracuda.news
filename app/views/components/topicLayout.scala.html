@import components._
@import models.CoreModels.Article
@import models.CoreModels.Layout
@import models.CoreModels.NewsType

@(layoutOpt: Option[Layout], news: Seq[Article], rootTag: Option[String] = None)

@{
    layoutOpt match {
        case Some(layout) => layoutGrid(layout, news)
        case _ => listGrid(news)
    }
}

@listGrid(news: Seq[Article]) = {
    LIST NEWS
}

@layoutGrid(layout: Layout, news: Seq[Article]) = {
@for(row <- layout.rows) {
    <div class="topic-row @row.height.cssClass">
    @for(block <- row.blocks) {
        @if(block.tag) {
            <div class="topic-col @block.size.cssClass @if(block.featured) {featured} type-@block.newsType.cssClass @if(block.caption.isEmpty) {no-caption}">
                @for(caption <- block.caption) {
                    <h1>@caption</h1>
                }
                <div class="items">
                @{
                    val newsToDisplay = block.newsType match {
                        case NewsType.TEXT => news.filter(t => t.hasTag(block.tag))
                        case _ => news.find(t => t.hasTag(block.tag)).toSeq
                    }
                    newsToDisplay.take(row.height.maxNews) match {
                        case head :: tail =>
                            val firstArticle = List(article(head, block.newsType, first = true))
                            val restArticles = tail.map(t => article(t, block.newsType))
                            firstArticle ++ List(Html("""<div class="rest-items">""")) ++ restArticles ++ List(Html("</div>"))
                        case _ =>
                            Html(
                                s"""<h1>Empty topic</h1>
                                 <p>Type: ${block.newsType}</p>
                                 <p>Topic tags: ${rootTag.getOrElse("")} ${block.tag}</p>"""
                            )
                    }
                }
                </div>
            </div>
        }
    }
    </div>
}
}

